# 政府效能督查系统开发指南

## 项目概述

政府效能督查系统是一个基于 FastAPI + React + Docker 的现代化 Web 应用，旨在提高政府部门工作效率、强化执行力监督、确保政务工作落实到位。

## 技术架构

### 后端技术栈
- **FastAPI**: 现代、快速的 Web 框架
- **SQLAlchemy**: ORM 数据库操作
- **PostgreSQL**: 关系型数据库
- **Redis**: 缓存和会话存储
- **Alembic**: 数据库迁移工具
- **Python-Jose**: JWT 令牌处理
- **Pydantic**: 数据验证和序列化

### 前端技术栈
- **React 18**: UI 框架
- **TypeScript**: 类型安全
- **Ant Design**: UI 组件库
- **React Router**: 路由管理
- **React Query**: 数据获取和状态管理
- **Zustand**: 全局状态管理
- **Axios**: HTTP 客户端

### 部署技术
- **Docker**: 容器化部署
- **Docker Compose**: 多服务编排
- **Nginx**: 反向代理和静态文件服务

## 已完成功能

### ✅ 基础架构
- [x] 项目目录结构
- [x] Docker 容器化配置
- [x] 数据库模型设计
- [x] 核心配置管理

### ✅ 后端核心模块
- [x] FastAPI 主应用
- [x] 数据库连接和 ORM 配置
- [x] Alembic 数据库迁移
- [x] JWT 认证系统
- [x] 权限管理框架
- [x] API 路由结构
- [x] 中间件配置

### ✅ 数据模型
- [x] 用户管理模型 (User, Role, Permission)
- [x] 组织架构模型 (Organization, Department)
- [x] 督办事项模型 (SupervisionItem, TaskAssignment, ProgressReport)
- [x] 工作流模型 (WorkflowTemplate, WorkflowInstance, WorkflowNode)
- [x] 通知模型 (Notification, NotificationTemplate)
- [x] 附件模型 (Attachment)
- [x] 系统配置模型 (SystemConfig, OperationLog)

### ✅ 前端基础架构
- [x] React 应用配置
- [x] TypeScript 类型定义
- [x] 路由配置
- [x] 状态管理 (Zustand)
- [x] API 服务层
- [x] 认证服务
- [x] 登录页面
- [x] 布局组件结构

## 项目结构

```
ducha/
├── backend/                 # FastAPI 后端
│   ├── app/
│   │   ├── api/            # API 路由
│   │   │   └── api_v1/
│   │   │       └── endpoints/
│   │   ├── core/           # 核心配置
│   │   ├── db/             # 数据库配置
│   │   ├── models/         # 数据模型
│   │   ├── schemas/        # Pydantic 模式
│   │   ├── services/       # 业务逻辑
│   │   └── utils/          # 工具函数
│   ├── alembic/            # 数据库迁移
│   ├── requirements.txt    # Python 依赖
│   └── Dockerfile
├── frontend/               # React 前端
│   ├── src/
│   │   ├── components/     # React 组件
│   │   ├── pages/          # 页面组件
│   │   ├── services/       # API 服务
│   │   ├── store/          # 状态管理
│   │   ├── types/          # TypeScript 类型
│   │   └── utils/          # 工具函数
│   ├── package.json        # Node.js 依赖
│   └── Dockerfile
├── docker-compose.yml      # Docker Compose 配置
├── nginx.conf             # Nginx 配置
└── README.md
```

## 快速开始

### 1. 环境准备

确保已安装：
- Docker 和 Docker Compose
- Node.js 18+ (本地开发需要)
- Python 3.11+ (本地开发需要)

### 2. 配置环境变量

```bash
# 复制环境变量模板
cp .env.example .env

# 编辑环境变量文件
nano .env
```

### 3. 使用 Docker Compose 启动

```bash
# 启动所有服务
docker-compose up -d

# 查看服务状态
docker-compose ps

# 查看日志
docker-compose logs -f
```

### 4. 访问应用

- 前端应用: http://localhost:3000
- 后端 API: http://localhost:8000
- API 文档: http://localhost:8000/docs

### 5. 默认账号

- 用户名: admin
- 密码: admin123

## 本地开发

### 后端开发

```bash
cd backend

# 创建虚拟环境
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# 安装依赖
pip install -r requirements.txt

# 启动开发服务器
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

### 前端开发

```bash
cd frontend

# 安装依赖
npm install

# 启动开发服务器
npm start
```

### 数据库迁移

```bash
cd backend

# 生成迁移文件
alembic revision --autogenerate -m "migration message"

# 执行迁移
alembic upgrade head
```

## 下一步开发计划

### 🚧 待完成功能

1. **督办事项管理API** (高优先级)
   - 督办事项 CRUD 操作
   - 任务分配和进度跟踪
   - 状态变更和日志记录

2. **流程管控和协同办理** (中优先级)
   - 工作流引擎实现
   - 审批流程管理
   - 多部门协同机制

3. **监控预警机制** (中优先级)
   - 智能监控系统
   - 四级预警机制
   - 自动化催办提醒

4. **前端核心页面** (中优先级)
   - 仪表板页面
   - 督办管理页面
   - 用户管理页面
   - 系统设置页面

5. **数据可视化** (中优先级)
   - 图表组件封装
   - 统计分析页面
   - 报表生成功能

6. **系统集成测试** (中优先级)
   - 前后端联调
   - 功能测试
   - 性能优化

7. **部署文档完善** (低优先级)
   - 生产环境部署指南
   - 运维监控配置
   - 备份恢复策略

## 开发规范

### 代码风格
- Python: 遵循 PEP 8 规范
- TypeScript: 使用 ESLint + Prettier
- 提交信息: 使用约定式提交格式

### 数据库规范
- 使用 UUID 作为主键
- 统一的时间戳字段 (created_at, updated_at)
- 软删除机制 (is_deleted, deleted_at)
- 完整的外键约束

### API 设计规范
- RESTful API 设计
- 统一的响应格式
- 完善的错误处理
- 详细的 API 文档

### 安全规范
- JWT 令牌认证
- 权限控制中间件
- SQL 注入防护
- XSS 防护
- CORS 配置

## 故障排除

### 常见问题

1. **数据库连接失败**
   - 检查 PostgreSQL 服务是否启动
   - 确认数据库连接字符串配置正确

2. **端口冲突**
   - 修改 docker-compose.yml 中的端口映射
   - 或停止占用端口的其他服务

3. **前端编译错误**
   - 删除 node_modules 和 package-lock.json
   - 重新执行 npm install

4. **权限问题**
   - 确保 Docker 有足够的权限
   - 检查文件夹的读写权限

### 日志查看

```bash
# 查看所有服务日志
docker-compose logs -f

# 查看特定服务日志
docker-compose logs -f backend
docker-compose logs -f frontend
docker-compose logs -f db
```

## 贡献指南

1. Fork 项目仓库
2. 创建功能分支: `git checkout -b feature/new-feature`
3. 提交更改: `git commit -am 'Add new feature'`
4. 推送分支: `git push origin feature/new-feature`
5. 提交 Pull Request

## 许可证

MIT License

## 联系方式

如有问题或建议，请通过以下方式联系：
- 创建 GitHub Issue
- 发送邮件至项目维护者